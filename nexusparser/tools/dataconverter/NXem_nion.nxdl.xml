<?xml version="1.0" ?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<definition category="application" extends="NXobject" name="NXem_nion" type="group" xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.w3.org/2001/XMLSchema-instance">
	<doc>Template for creating draft application definitions for storing data and metadata for experiments with scanning transmission electron microscopy with a Nion instrument.</doc>
	<group type="NXentry">
		<field name="definition" type="NX_CHAR">
			<doc>Official NeXus NXDL schema to which this entry conforms.</doc>
			<attribute name="version" type="NX_CHAR">
				<doc>Version specifier which enables documentation of modifications to the schema.</doc>
			</attribute>
		</field>
		<field name="experiment_identifier" type="NX_CHAR">
			<doc>Ideally, a (globally persistent) unique identifier for referring to this experiment. The identifier is usually defined/issued by the facility, laboratory, or the principle investigator. The identifier enables to link experiments to e.g. proposals.</doc>
		</field>
		<field name="experiment_description" optional="true" type="NX_CHAR">
			<doc>Possibility for leaving a free-text description about the experiment. Users are strongly advised to detail the sample history in the respective field and fill rather as completely as possible the fields of this application definition rather than writing these details in prose into this field.</doc>
		</field>
		<field name="start_time" type="NX_DATE_TIME">
			<doc>ISO 8601 formatted time code with local time zone offset to UTC information included when the experiment started. If the application demands that time codes in this section of the application definition should only be used for specifying when the experiment was performed - and the exact duration is not relevant - this start time field should be used. Often though it is useful to specify a time interval with specifying both start_time and end_time to allow for more detailed bookkeeping and interpretation of the experiment. The user should be aware that even with having both time instances specified it may not be advisable to infer how long the experiment took or for how long data were acquired. More detailed timing data over the course of the experiment have to be collected.</doc>
		</field>
		<field name="end_time" recommended="true" type="NX_DATE_TIME">
			<doc>ISO 8601-formatted time code with local time zone offset to UTC included when the experiment ended.</doc>
		</field>
		<field name="program_name" type="NX_CHAR">
			<doc>Commercial or otherwise given name to the program which was used to acquire/measure the dataset. Electron microscopy experiments are usually controlled/performed via commercial integrated acquisition and instrument control software. In many cases, an EM dataset is useful only if gets post-processed already during the acquisition or shortly thereafter, i.e. while the scientists is still sitting at the microscope. Many of these processes are automated, if not they virtually involve GUI interactions with the control software. Examples include collecting of diffraction pattern and on-the-fly indexing of these. These situations and tools are realized with individual NXprocess groups which can hold more details and numerical data to these processing steps. Frequently, some of these NXprocess groups are performed with (open-source) research software. Therefore, there is strictly speaking not a single program used in electron microscopy, and thus each NXprocess has its own program name and description.&quot;</doc>
			<attribute name="version" type="NX_CHAR">
				<doc>Ideally program version plus build number, or commit hash or description of ever persistent resources where the source code of the program and build instructions can be found so that the program can be configured ideally in such a manner that the result file is numerically recreatable in the same deterministic manner.</doc>
			</attribute>
		</field>
		<group name="experiment_documentation" optional="true" type="NXnote">
			<doc>Binary container for a file or a compressed collection of files which can be used to add further descriptions and details to the experiment. The container can hold e.g. a ppt, pdf, latex, txt, image, or zip archive ...).</doc>
		</group>
		<group name="thumbnail" recommended="true" type="NXnote">
			<doc>A small image that is representative of the entry. This can be an image from the dataset or a thumbnail of a spectrum. Either way it is recommended to use 640x480 pixel jpeg image. Adding a scale bar to that image is recommended but not required as the main purpose of the thumbnail is to provide e.g. thumbnail images for displaying them in data repositories.</doc>
			<attribute name="type"/>
		</group>
		<group minOccurs="1" name="operator" type="NXuser">
			<doc>Contact information of at least the user of the instrument who measured this specimen or the principal investigator who performed this experiment. Adding multiple users if relevant is recommended.</doc>
			<field name="name" type="NX_CHAR">
				<doc>Given (first) name and surname of the user.</doc>
			</field>
			<field name="affiliation" recommended="true" type="NX_CHAR">
				<doc>Name of the affiliation of the user at the point in time when the experiment was performed.</doc>
			</field>
			<field name="address" recommended="true" type="NX_CHAR">
				<doc>Postal address of the affiliation.</doc>
			</field>
			<field name="email" type="NX_CHAR">
				<doc>Email address of the user at the point in time when the experiment was performed. Given the most permanently used email is recommended.</doc>
			</field>
			<field name="orcid" recommended="true" type="NX_CHAR">
				<doc>Globally unique identifier of the user as offers by services like ORCID or Researcher ID.</doc>
			</field>
			<field name="telephone_number" recommended="true" type="NX_CHAR">
				<doc>(Business) (tele)phone number of the user at the point in time when the experiment was performed.</doc>
			</field>
			<field name="role" recommended="true" type="NX_CHAR">
				<doc>Which role does the user have in the place, and at the point in time when, the experiment was performed (e.g. technician operating the microscope, student, postdoc, principal investigator, guest ...).</doc>
			</field>
		</group>
		<group type="NXsample">
			<field name="name" type="NX_CHAR">
				<doc>Descriptive name or identifier with which to distinguish the specimen from all others and especially the parts from where it was cut. In cases where the specimen was e.g. site-specifically cut from samples or in cases of an instrument session during which multiple specimens are loaded, the name has to be descriptive enough to resolve which specimen was investigated and is represented by this NXentry. The user is advised to store the details how specimens were cut/prepared from samples in the sample history.</doc>
			</field>
			<field name="sample_history" type="NX_CHAR">
				<doc>Ideally, a reference to the location of or a (globally persistent) unique identifier of e.g. another file which should document ideally as many details as possible of the material, its microstructure, and its thermo-chemo-mechanical processing/preparation history. In the case that such a detailed history of the sample/specimen is not available, use this field as a free-text description to specify a sub-set of the entire sample history, i.e. what you would consider being the key steps and relevant information about the specimen, its material, microstructure, thermo-chemo-mechanical processing state and details of the preparation.</doc>
			</field>
			<field name="preparation_date" recommended="true" type="NX_DATE_TIME">
				<doc>ISO8601 date and time with local time zone offset to UTC included when the specimen was prepared. Ideally report the end of the preparation, i.e. the last known time the measured specimen surface was actively prepared. Knowing when the specimen was exposed to e.g. specific atmosphere is especially required for environmentally sensitive material such as hydrogen-charged specimens or experiments including tracers with a short half-time. The user is advised to include these temporal details in the sample_history.</doc>
			</field>
			<field name="short_title" optional="true" type="NX_CHAR">
				<doc>Possibility to give an abbreviation of the specimen name field.</doc>
			</field>
			<field name="atom_types" type="NX_CHAR">
				<doc>Use Hill's system for listing elements of the periodic table which are inside or attached to the surface of the specimen and thus relevant from a scientific point. The purpose of the field is to offer materials database systems an opportunity to parse the relevant elements without having to interpret these from the sample history.</doc>
			</field>
			<field name="thickness" recommended="true" type="NX_FLOAT" units="NX_LENGTH">
				<doc>(Measured) sample thickness</doc>
			</field>
		</group>
		<group type="NXdata">
			<doc>Hard link to a location/locations in the hierarchy of the NeXus file where the data for default plotting are stored.</doc>
		</group>
		<group name="em_lab" type="NXinstrument">
			<doc>Metadata and numerical data of not only the microscope but also the lab in which this microscope is located.</doc>
			<field name="name" type="NX_CHAR">
				<doc>Given name of the microscope, e.g. NionHermes.</doc>
			</field>
			<field name="location" recommended="true" type="NX_CHAR">
				<doc>Geographic coordinates of the lab or the place where the instrument is installed using GEOREF geocodes ideally.</doc>
			</field>
			<field name="instrument_manufacturer" type="NX_CHAR">
				<doc>Manufacturer of the entire instrument to enable e.g. queries in materials database systems for instrument manufacturers. Usually more technical details are needed though to specify the instrument, these should be written into instrument_model and instrument_capabilities.</doc>
			</field>
			<field name="instrument_model" type="NX_CHAR">
				<doc>Manufacturer brand/model to enable e.g. queries about microscope models. See comments on instrument_manufacturer on how to provide further specification.</doc>
			</field>
			<field name="instrument_identifier" recommended="true" type="NX_CHAR">
				<doc>Hardware name/serial number or hash identifier given by the manufacturer to identify the instrument.</doc>
			</field>
			<field name="instrument_capability" recommended="true" type="NX_CHAR">
				<doc>Free-text list possibly multiple terms of functionalities which the instrument provides.</doc>
			</field>
			<group name="electron_gun" type="NXsource">
				<doc>The source creating the electron beam.</doc>
				<field name="voltage" type="NX_FLOAT" units="NX_VOLTAGE">
					<doc>Voltage relevant to compute the energy of the electrons immediately after they left the gun.</doc>
				</field>
				<field name="probe" optional="true" type="NX_CHAR">
					<doc>Type of radiation.</doc>
					<enumeration>
						<item value="electron"/>
					</enumeration>
				</field>
				<field name="emitter_type" recommended="true" type="NX_CHAR">
					<doc>Emitter type used to create the beam.</doc>
					<enumeration>
						<item value="thermionic"/>
						<item value="schottky"/>
						<item value="field emission"/>
					</enumeration>
				</field>
				<field name="description" recommended="true" type="NX_CHAR">
					<doc>Ideally a reference to (another) file (ideally formatted using also an application definition) via a link, name, or a (globally persistent) unique identifier to give further details about the electron gun.</doc>
				</field>
			</group>
			<group maxOccurs="unbounded" minOccurs="0" type="NXaperture">
				<doc>Details to individual apertures in the instrument.</doc>
				<field name="name" recommended="true" type="NX_CHAR">
					<doc>Given name.</doc>
				</field>
				<field name="model" recommended="true" type="NX_CHAR">
					<doc>Given brand or model name by the manufacturer.</doc>
				</field>
				<field name="serial_number" recommended="true" type="NX_CHAR">
					<doc>Given hardware name/serial number or hash identifier issued by the manufacturer.</doc>
				</field>
				<field name="manufacturer_name" recommended="true" type="NX_CHAR">
					<doc>Given name of the manufacturer.</doc>
				</field>
				<field name="value" type="NX_NUMBER" units="NX_ANY">
					<doc>Relevant value from the control software as this is not always just the diameter of (not even in the case) of a circular aperture but a rather a value from a list of predefined ones in the control software. Which actual settings are behind these should be Details which choice was made should be explained under description.</doc>
				</field>
				<field name="description" recommended="true" type="NX_CHAR">
					<doc>An (ideally globally persistent) unique identifier, link, or text which gives further details.</doc>
				</field>
				<group optional="true" type="NXtransformations">
					<doc>Affine transformations and geometrical descriptions which detail how the aperture is placed and arranged in the microscope relative to the optical axis and beam path.</doc>
				</group>
			</group>
			<group optional="true" type="NXlens_em">
				<doc>Details to individual lenses in the microscope.</doc>
				<field name="type" recommended="true" type="NX_CHAR">
					<doc>Which type describes the type of the lens closest?</doc>
					<enumeration>
						<item value="single"/>
						<item value="double"/>
						<item value="quadrupole"/>
						<item value="hexapole"/>
						<item value="octopol"/>
					</enumeration>
				</field>
				<field name="name" type="NX_CHAR"/>
				<field name="model" recommended="true" type="NX_CHAR"/>
				<field name="serial_number" recommended="true" type="NX_CHAR"/>
				<field name="manufacturer_name" recommended="true" type="NX_CHAR"/>
				<field name="description" recommended="true" type="NX_CHAR"/>
				<group optional="true" type="NXtransformations"/>
			</group>
			<group optional="true" type="NXcorrector_cs">
				<doc>Details about an eventual device which corrects spherical aberrations.</doc>
				<field name="has_cs_corrector" type="NX_BOOLEAN">
					<doc>Does the microscope have a spherical aberration correction unit and was it used?</doc>
				</field>
				<field name="name" recommended="true" type="NX_CHAR"/>
				<field name="model" recommended="true" type="NX_CHAR"/>
				<field name="serial_number" recommended="true" type="NX_CHAR"/>
				<field name="manufacturer_name" recommended="true" type="NX_CHAR"/>
				<field name="description" recommended="true" type="NX_CHAR"/>
				<field name="c_1_0" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="c_1_2_a" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="c_1_2_b" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="c_2_1_a" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="c_2_1_b" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="c_2_3_a" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="c_2_3_b" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="c_3_0" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="c_3_2_a" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="c_3_2_b" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="c_3_4_a" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="c_3_4_b" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="c_5_0" type="NX_FLOAT" units="NX_LENGTH"/>
				<group optional="true" type="NXtransformations"/>
			</group>
			<group type="NXstage_lab">
				<field name="design" recommended="true" type="NX_CHAR"/>
				<field name="name" recommended="true" type="NX_CHAR"/>
				<field name="model" recommended="true" type="NX_CHAR"/>
				<field name="serial_number" recommended="true" type="NX_CHAR"/>
				<field name="manufacturer_name" recommended="true" type="NX_CHAR"/>
				<field name="description" recommended="true" type="NX_CHAR"/>
				<field name="tilt1" type="NX_FLOAT" units="NX_ANGLE">
					<doc>Stage tilt A. Exact definition as understood by HU colleagues remains to be communicated.</doc>
				</field>
				<field name="tilt2" type="NX_FLOAT" units="NX_ANGLE">
					<doc>Stage tilt B. Exact definition as understood by HU colleagues remains to be communicated.</doc>
				</field>
				<field name="position" type="NX_FLOAT" units="NX_LENGTH">
					<doc>StageOutX, Y, Z. Exact definition as understood by HU colleagues remains to be communicated.</doc>
					<dimensions rank="1">
						<dim index="1" value="3"/>
					</dimensions>
				</field>
				<group optional="true" type="NXtransformations"/>
				<group optional="true" type="NXpositioner"/>
			</group>
			<group type="NXdetector">
				<doc>Description of the type of the detector e.g. CCD, scintillator, direct electron, image plate, CMOS.</doc>
				<field name="name" recommended="true" type="NX_CHAR">
					<doc>Given name.</doc>
				</field>
				<field name="model" recommended="true" type="NX_CHAR">
					<doc>Given brand or model name by the manufacturer.</doc>
				</field>
				<field name="serial_number" recommended="true" type="NX_CHAR">
					<doc>Given hardware name/serial number or hash identifier issued by the manufacturer.</doc>
				</field>
				<field name="manufacturer_name" recommended="true" type="NX_CHAR">
					<doc>Given name of the manufacturer.</doc>
				</field>
				<field name="sensor_material" recommended="true" type="NX_CHAR"/>
				<field name="bit_depth_readout" recommended="true" type="NX_INT"/>
				<field name="number_of_cycles" recommended="true" type="NX_INT"/>
				<field name="x_pixel_size" recommended="true" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="y_pixel_size" recommended="true" type="NX_FLOAT" units="NX_LENGTH"/>
				<field name="flatfield_applied" type="NX_BOOLEAN"/>
				<field name="flatfield" recommended="true" type="NX_FLOAT"/>
				<field name="exposure" recommended="true" type="NX_NUMBER" units="NX_TIME"/>
				<field name="description" type="NX_CHAR">
					<doc>Free text option to write further details about the detector.</doc>
				</field>
			</group>
			<group name="miscellaneous" type="NXcollection">
				<field name="camera_length" recommended="true" type="NX_FLOAT" units="NX_LENGTH">
					<doc>Exact definition as understood by HU colleagues remains to be communicated.</doc>
				</field>
				<field name="magnification" recommended="true" type="NX_FLOAT" units="NX_DIMENSIONLESS">
					<doc>Exact definition as understood by HU colleagues remains to be communicated.</doc>
				</field>
				<field name="defocus" type="NX_FLOAT" units="NX_LENGTH">
					<doc>Exact definition as understood by HU colleagues and Nion remains to be communicated.</doc>
				</field>
				<field name="semi_convergence_angle" type="NX_FLOAT" units="NX_ANGLE">
					<doc>Details how computed needs to be confirmed by Nion.</doc>
				</field>
			</group>
			<group name="hadf" optional="true" type="NXprocess">
				<field name="program" type="NX_CHAR">
					<doc>Container for reporting individually processed images with the HAADF detector ?</doc>
					<attribute name="version" type="NX_CHAR">
						<doc>Ideally program version plus build number, or commit hash or description of ever persistent resources where the source code of the program and build instructions can be found so that the program can be configured ideally in such a manner that the result of this computational process is recreatable in the same deterministic manner.</doc>
					</attribute>
				</field>
				<field name="haadf_inner_half_angle" type="NX_FLOAT" units="NX_ANGLE">
					<doc>HAADF annulus inner half angle ?</doc>
				</field>
				<field name="haadf_outer_half_angle" type="NX_FLOAT" units="NX_ANGLE">
					<doc>HAADF annulus outer half angle ?</doc>
				</field>
				<group type="NXscanbox_em">
					<symbols>
						<symbol doc="Number of pixel in the x direction" name="n_x"/>
						<symbol doc="Number of pixel in the y direction" name="n_y"/>
						<symbol doc="Physical size of a pixel in x direction" name="d_x"/>
						<symbol doc="Physical size of a pixel in y direction" name="d_y"/>
					</symbols>
					<doc>Description of the scan box which is instructed by the microscope control software to direct the probe to controlled locations according to a scan scheme and plan.</doc>
					<field name="program" type="NX_CHAR">
						<doc>Commercial or otherwise given name to the program which was used to execute this analysis.</doc>
						<attribute name="version" type="NX_CHAR">
							<doc>Ideally program version plus build number, or commit hash or description of ever persistent resources where the source code of the program and build instructions can be found so that the program can be configured ideally in such a manner that the result of this computational process is recreatable in the same deterministic manner.</doc>
						</attribute>
					</field>
					<field name="calibration_style" recommended="true" type="NX_CHAR">
						<doc>Remains to be discussed with colleagues which suggestions to put as enumerations.</doc>
						<enumeration>
							<item value="space"/>
						</enumeration>
					</field>
					<field name="center" recommended="true" type="NX_NUMBER" units="NX_ANY">
						<doc>Remains to be discussed with colleagues how to use and interpret this.</doc>
					</field>
					<field name="flyback_time" recommended="true" type="NX_FLOAT" units="NX_TIME">
						<doc>Remains to be discussed with colleagues how to use and interpret this.</doc>
					</field>
					<field name="field_of_view" recommended="true" type="NX_FLOAT" units="NX_LENGTH">
						<doc>Remains to be discussed with colleagues how to use and interpret this.</doc>
					</field>
					<field name="line_time" recommended="true" type="NX_FLOAT" units="NX_TIME">
						<doc>Remains to be discussed with colleagues how to use and interpret this.</doc>
					</field>
					<field name="pixel_time" recommended="true" type="NX_FLOAT" units="NX_TIME">
						<doc>Remains to be discussed with colleagues how to use and interpret this.</doc>
					</field>
					<field name="requested_pixel_time" recommended="true" type="NX_FLOAT" units="NX_TIME">
						<doc>Remains to be discussed with colleagues how to use and interpret this.</doc>
					</field>
					<field name="rotation" recommended="true" type="NX_FLOAT" units="NX_ANGLE">
						<doc>Remains to be discussed with colleagues how to use and interpret this.</doc>
					</field>
					<field name="ac_line_sync" recommended="true" type="NX_BOOLEAN">
						<doc>Remains to be discussed with colleagues how to use and interpret this.</doc>
					</field>
					<group name="mag_boards" recommended="true" type="NXcollection">
						<doc>Detailed settings of an internal board(s) in the scanbox device. Further information exchange/discussions with Nion is needs to elucidate what these are.</doc>
						<field name="board_0_dac_0" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_0_dac_1" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_0_dac_10" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_0_dac_11" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_0_dac_2" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_0_dac_3" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_0_dac_4" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_0_dac_5" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_0_dac_6" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_0_dac_7" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_0_dac_8" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_0_dac_9" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_0_relay" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_dac_0" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_dac_1" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_dac_10" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_dac_11" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_dac_2" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_dac_3" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_dac_4" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_dac_5" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_dac_6" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_dac_7" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_dac_8" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_dac_9" type="NX_NUMBER" units="NX_UNITLESS"/>
						<field name="board_1_relay" type="NX_NUMBER" units="NX_UNITLESS"/>
					</group>
				</group>
				<group type="NXdata">
					<symbols>
						<symbol doc="Number of pixel in the x direction" name="n_x"/>
						<symbol doc="Number of pixel in the y direction" name="n_y"/>
					</symbols>
					<doc>Container for holding an image (stack) taken with the HA(A) ? DF detector.</doc>
					<attribute name="signal"/>
					<attribute name="axes"/>
					<attribute name="xpos_indices"/>
					<attribute name="ypos_indices"/>
					<field name="intensity" type="NX_NUMBER" units="NX_UNITLESS">
						<doc>Image intensity values.</doc>
						<dimensions rank="2">
							<dim index="0" value="n_x"/>
							<dim index="1" value="n_y"/>
						</dimensions>
					</field>
					<attribute name="long_name">
						<doc>Label for the y axis.</doc>
					</attribute>
					<field name="xpos" type="NX_NUMBER" units="NX_LENGTH">
						<doc>Pixel barycenter position x-coordinates.</doc>
						<dimensions rank="1">
							<dim index="0" value="n_x"/>
						</dimensions>
					</field>
					<field name="ypos" type="NX_NUMBER" units="NX_LENGTH">
						<doc>Pixel barycenter position y-coordinates.</doc>
						<dimensions rank="1">
							<dim index="1" value="n_y"/>
						</dimensions>
					</field>
				</group>
			</group>
		</group>
	</group>
</definition>
