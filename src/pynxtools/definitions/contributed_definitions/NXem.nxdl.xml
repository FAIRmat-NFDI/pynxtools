<?xml version='1.0' encoding='UTF-8'?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<!--
# NeXus - Neutron and X-ray Common Data Format
#
# Copyright (C) 2014-2024 NeXus International Advisory Committee (NIAC)
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 3 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
# For further information, see http://www.nexusformat.org
-->
<definition xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" category="application" type="group" name="NXem" extends="NXobject" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
    <doc>
         Application definition for normalized representation of electron microscopy research.
         
         This application definition is a comprehensive example for a general description
         with which to normalize specific pieces of information and data collected within
         electron microscopy research.
         
         NXem is designed to be used for documentation of experiments or computer simulations
         of controlled electron beams which are used for studying electron-beam matter interaction
         to explore physical mechanisms and phenomena, or to characterize materials with
         electron microscopy.
    </doc>
    <!--\@NX_class:
\@file_time(NX_DATE_TIME):
\@file_name(NX_CHAR):
\@file_update_time(NX_DATE_TIME):
\@NeXus_version(NX_CHAR):
\@HDF5_Version(NX_CHAR):
\@h5py_version(NX_CHAR):
\@default(NX_CHAR):-->
    <group type="NXentry" minOccurs="1" maxOccurs="unbounded">
        <field name="definition" type="NX_CHAR">
            <attribute name="version" type="NX_CHAR" optional="true"/>
            <enumeration>
                <item value="NXem"/>
            </enumeration>
        </field>
        <!--each NeXus file instance should have a default plot
however as there are cases when this cannot be assured we cannot
make the default required, one example is e.g. a NeXus instance
where scientists just store conventions without a default plot-->
        <group name="profiling" type="NXcs_profiling" optional="true">
            <doc>
                 The configuration of the I/O writer software (e.g. `pynxtools &lt;https://github.com/FAIRmat-NFDI/pynxtools&gt;`_ or its plugins)
                 which was used to generate this NeXus file instance.
            </doc>
            <!--command_line_call(NX_CHAR):-->
            <group type="NXprogram" minOccurs="0" maxOccurs="unbounded">
                <doc>
                     A collection of all programs and libraries which are considered relevant
                     to understand with which software tools this NeXus file instance was
                     generated. Ideally, to enable a binary recreation from the input data.
                     
                     Examples include the name and version of the libraries used to write the
                     instance. Ideally, the software which writes these NXprogram instances
                     also includes the version of the set of NeXus classes i.e. the specific
                     set of base classes, application definitions, and  contributed definitions
                     with which the here described concepts can be resolved.
                     
                     For the `pynxtools library &lt;https://github.com/FAIRmat-NFDI/pynxtools&gt;`_
                     which is used by the `NOMAD &lt;https://nomad-lab.eu/nomad-lab&gt;`_
                     research data management system, it makes sense to store e.g. the GitHub
                     repository commit and respective submodule references used.
                </doc>
                <field name="program" type="NX_CHAR">
                    <attribute name="version" type="NX_CHAR"/>
                </field>
            </group>
        </group>
        <!--\@url:-->
        <group name="experiment_identifier" type="NXidentifier" recommended="true">
            <doc>
                 Ideally, a (globally) unique persistent identifier for referring to this experiment.
                 
                 An experiment should be understood in that this can be an experiment
                 in reality or a computer simulation because also the latter is an experiment
                 (see the Cambridge Dictionary experiment: *a test done in order to find out
                 something, eg if an idea is correct*).
                 
                 The identifier is usually issued by the facility, laboratory, or the principle investigator.
                 The identifier enables to link experiments/simulations to e.g. proposals.
            </doc>
            <field name="service" type="NX_CHAR"/>
            <field name="identifier" type="NX_CHAR"/>
            <field name="is_persistent" type="NX_BOOLEAN"/>
        </group>
        <field name="experiment_alias" type="NX_CHAR">
            <doc>
                 Either an identifier or an alias that is human-friendly so that scientists find
                 that experiment again.
            </doc>
        </field>
        <field name="experiment_description" type="NX_CHAR" optional="true">
            <doc>
                 Free-text description about the experiment.
                 
                 Users are strongly advised to parameterize the description of their experiment
                 by using respective groups and fields and base classes instead of writing prose
                 into this field.
                 
                 The reason is that such free-text field is difficult to machine-interpret.
                 The motivation behind keeping this field for now is to learn in how far the
                 current base classes need extension based on user feedback.
            </doc>
        </field>
        <field name="start_time" type="NX_DATE_TIME">
            <doc>
                 ISO 8601 time code with local time zone offset to UTC information included
                 when the microscope session started. If the application demands that time
                 codes in this section of the application definition should only be used
                 for specifying when the experiment was performed - and the exact
                 duration is not relevant - this start_time field should be used.
                 
                 Often though it is useful to specify a time interval via setting both a start_time
                 and an end_time because this enables software tools and users to collect a
                 more detailed bookkeeping of the experiment.
                 
                 Users should be aware though that even with having both time instances
                 specified, it may not be possible to infer how long the experiment took or
                 for how long data were acquired.
                 
                 More detailed timing data over the course of the experiment have
                 to be collected to compute this. These computations can take
                 advantage of individual time stamps start_time and end_time
                 in :ref:`NXevent_data_em` instances.
            </doc>
        </field>
        <field name="end_time" type="NX_DATE_TIME" recommended="true">
            <doc>
                 ISO 8601 time code with local time zone offset to UTC included when
                 the microscope session ended. See docstring of the start_time field
                 to see how the start_time and end_time should be used together.
            </doc>
        </field>
        <group type="NXcite" minOccurs="0" maxOccurs="unbounded"/>
        <group type="NXserialized" minOccurs="0" maxOccurs="unbounded">
            <doc>
                 Possibility to store a collection of serialized resources that are associated
                 with the experiment. An example how to use this set could be to document
                 from which files, which have been e.g. generated by software of technology
                 partners, the information in an instance of NXem was filled with.
                 
                 If resources from technology partners would also be documented with semantic
                 technology there would not even be a necessity to copy over specific information
                 into other files as one could write inference and information/fact/knowledge retrieval
                 algorithm(s) whereby a specific piece of information that is related to an experiment
                 or simulation is read directly from the respective file of the technology partner.
                 
                 The reason why currently this works convincingly in hardly any research data
                 management system (RDMS) is the strong heterogeneity of the information contained
                 in such files and the fact that often context and documentation, specifically
                 rich semantic documentation, and contextualization is missing.
            </doc>
            <!--using NXserialized here instead of NXnote as the former is more specific-->
            <field name="type" type="NX_CHAR"/>
            <field name="path" type="NX_CHAR"/>
            <field name="checksum" type="NX_CHAR"/>
            <field name="algorithm" type="NX_CHAR"/>
        </group>
        <group type="NXuser" minOccurs="0" maxOccurs="unbounded">
            <doc>
                 Contact information and eventually details of at least one person
                 who performed or was involved in the microscope session or simulation run.
                 This can be the principle investigator who performed this experiment or the
                 student who performed the simulation. Adding multiple users if relevant
                 is recommended.
            </doc>
            <field name="name" type="NX_CHAR" optional="true">
                <doc>
                     Given (first) name and surname of the user.
                </doc>
            </field>
            <field name="affiliation" type="NX_CHAR" optional="true">
                <doc>
                     Name of the affiliation of the user at the point in time
                     when the experiment was performed.
                </doc>
            </field>
            <field name="address" type="NX_CHAR" optional="true">
                <doc>
                     Postal address of the affiliation.
                </doc>
            </field>
            <field name="email" type="NX_CHAR" optional="true">
                <doc>
                     Email address of the user at the point in time when the experiment
                     was performed. Writing the most permanently used email is recommended.
                </doc>
            </field>
            <field name="telephone_number" type="NX_CHAR">
                <doc>
                     (Business) (tele)phone number of the user at the point
                     in time when the experiment was performed.
                </doc>
            </field>
            <field name="role" type="NX_CHAR">
                <doc>
                     Which role does the user have in the place and at the point
                     in time when the experiment was performed? Technician operating
                     the microscope, student, postdoc, principle investigator, or guest
                     are common examples.
                </doc>
            </field>
            <group name="identifier" type="NXidentifier" recommended="true">
                <doc>
                     Service as another mean of identification of a user other than by its name.
                     Examples could be an ORCID or social media account of the user.
                </doc>
                <field name="service" type="NX_CHAR"/>
                <field name="identifier" type="NX_CHAR"/>
                <field name="is_persistent" type="NX_BOOLEAN"/>
            </group>
        </group>
        <group name="sample" type="NXsample">
            <!--
NEW ISSUE: inject the conclusion from the discussion with Andrea
according to SAMPLE.yaml 0f8df14 2022/06/15
ID: -> maps to name
name: -> short_title
user: -> not matched right now
citation: doi ->why relevant, should be solved by RDMS
-->
            <doc>
                 A description of the material characterized in the experiment.
                 Sample and specimen are threaded as de facto synonyms.
                 Samples can be real specimens or virtual (see method).
            </doc>
            <field name="method" type="NX_CHAR">
                <doc>
                     A qualifier whether the sample is a real one or a
                     virtual one (in a computer simulation)
                </doc>
                <enumeration>
                    <item value="experiment"/>
                    <item value="simulation"/>
                </enumeration>
            </field>
            <group name="identifier" type="NXidentifier" recommended="true">
                <doc>
                     Ideally, (globally) unique persistent identifier which distinguishes the sample from all others
                     and especially the predecessor/origin from where that sample was cut.  The terms sample
                     and specimen are here considered as exact synonyms.
                     
                     This field must not be used for an alias! Instead, use name.
                     
                     In cases where multiple specimens were loaded into the microscope, the identifier has to resolve
                     the specific sample, whose results are stored by this :ref:`NXentry` instance because a single
                     NXentry should be used for the characterization of a single specimen.
                     
                     Details about the specimen preparation should be stored in resources referring to parent_identifier.
                </doc>
                <field name="service" type="NX_CHAR"/>
                <field name="identifier" type="NX_CHAR"/>
                <field name="is_persistent" type="NX_BOOLEAN"/>
            </group>
            <group name="parent_identifier" type="NXidentifier" recommended="true">
                <doc>
                     Identifier of the sample from which the sample was cut or the string *None*.
                     
                     The purpose of this field is to support functionalities for tracking
                     sample provenance in a research data management system.
                </doc>
                <field name="service" type="NX_CHAR"/>
                <field name="identifier" type="NX_CHAR"/>
                <field name="is_persistent" type="NX_BOOLEAN"/>
            </group>
            <field name="preparation_date" type="NX_DATE_TIME">
                <doc>
                     ISO 8601 time code with local time zone offset to UTC information
                     when the specimen was prepared.
                     
                     Ideally, report the end of the preparation, i.e. the last known timestamp when
                     the measured specimen surface was actively prepared. Ideally, this matches
                     the last timestamp that is mentioned in the digital resource pointed to by
                     parent_identifier.
                     
                     Knowing when the specimen was exposed to e.g. specific atmosphere is especially
                     required for environmentally sensitive material such as specimen charged with hydrogen
                     or experiments including tracers that have a short halflife. Additional time stamps
                     prior to preparation_date should better be placed in resources which describe but
                     which do not pollute the description here with prose. Resolving these connected
                     pieces of information is considered the responsibility of the
                     research data management system not of a NeXus file.
                </doc>
            </field>
            <field name="name" type="NX_CHAR" recommended="true">
                <doc>
                     An alias used to refer to the specimen to please readability for humans.
                </doc>
            </field>
            <field name="atom_types" type="NX_CHAR">
                <doc>
                     List of comma-separated elements from the periodic table that are contained in the sample.
                     If the sample substance has multiple components, all elements from each component
                     must be included in atom_types.
                     
                     The purpose of the field is to offer research data management systems an opportunity
                     to parse the relevant elements without having to interpret these from the resources
                     pointed to by parent_identifier or walk through eventually deeply nested groups in
                     individual data instances.
                </doc>
            </field>
            <field name="thickness" type="NX_NUMBER" optional="true" units="NX_LENGTH">
                <doc>
                     (Measured) sample thickness.
                     
                     The information is recorded to qualify if the beam used was likely
                     able to shine through the specimen. For scanning electron microscopy,
                     in many cases the specimen is typically thicker than what is
                     illuminatable by the electron beam.
                     
                     In this case the value should be set to the actual thickness of
                     the specimen viewed for an illumination situation where the nominal
                     surface normal of the specimen is parallel to the optical axis.
                </doc>
            </field>
            <!--\@units: nm
NEW ISSUE: error estimates of the thickness and origin, i.e. how the value was obtained would be useful
NEW ISSUE: error model
NEW ISSUE: the KIT/SCC SEM, TEM schemata further qualify samples whether they are conductive e/ibeam sensitive
etc. The problem with this is that beam sensitivity is too vague but spatiotemporal electron dose integral dependent
KIT/SCC distinguish further conductivity and magnetic properties. While the motivation is clear, making
it thus simple is likely problematic when the data entered in such fields remaining qualitative.
what are good or bad properties, it would make sense though to quantify these values
this includes the description of eventual plasma cleaning steps,
just knowing that a sample was plasma cleaned is insufficient, maybe it was not cleaned long enough
if plasma cleaning is done outside the EM than its certainly history, if it happens inside the EM
are the ibeam description capabilities not sufficient enough?-->
            <field name="density" type="NX_NUMBER" optional="true" units="NX_ANY">
                <doc>
                     (Measured) density of the specimen.
                     
                     For multi-layered specimens this field should only be used to describe
                     the density of the excited volume. For scanning electron microscopy
                     the usage of this field is discouraged and instead an instance of an 
                     :ref:`NXinteraction_vol_em` within individual :ref:`NXevent_data_em`
                     instances can provide a cleaner description of the relevant details
                     why one may wish to store the density of the specimen.
                </doc>
            </field>
            <field name="description" type="NX_CHAR" optional="true">
                <doc>
                     Discouraged free-text field to provide further detail although adding
                     parent_identifier and having a working research data management system
                     should provide this contextualization.
                </doc>
            </field>
        </group>
        <group name="coordinate_system_set" type="NXcoordinate_system_set" minOccurs="1" maxOccurs="1">
            <doc>
                 Set to hold different coordinate systems conventions.
                 Inspect the description of the :ref:`NXcoordinate_system_set`
                 and :ref:`NXcoordinate_system` base classes how to define
                 coordinate systems in NeXus.
            </doc>
            <group type="NXcoordinate_system" minOccurs="1" maxOccurs="unbounded">
                <field name="origin" type="NX_CHAR"/>
                <field name="alias" type="NX_CHAR"/>
                <field name="type" type="NX_CHAR"/>
                <field name="handedness" type="NX_CHAR"/>
                <field name="x_direction" type="NX_CHAR"/>
                <field name="y_direction" type="NX_CHAR"/>
                <field name="z_direction" type="NX_CHAR"/>
            </group>
        </group>
        <!--the description can be so lean because we do not need
to overwrite here s.th. as everything is defined already
we just say hey we need the above-mentioned fields
in the way they are defined in the respective composed base classes
and they have to be defined
we also should not need to specify the value type like R, NX_POSINT
because anyway within a group all field names have to be unique
so there must not be any name conflict and this we can take to our
advantage-->
        <group name="measurement" type="NXem_msr" optional="true">
            <group name="em_lab" type="NXinstrument">
                <field name="instrument_name" type="NX_CHAR" recommended="true"/>
                <field name="location" type="NX_CHAR" recommended="true"/>
                <group name="control_program" type="NXprogram" recommended="true">
                    <doc>
                         Details about the control program used for operating the microscope.
                    </doc>
                    <field name="program" type="NX_CHAR">
                        <attribute name="version" type="NX_CHAR"/>
                    </field>
                </group>
                <group type="NXfabrication">
                    <field name="vendor" type="NX_CHAR"/>
                    <field name="model" type="NX_CHAR"/>
                    <field name="identifier" type="NX_CHAR" recommended="true"/>
                </group>
                <group type="NXdetector" minOccurs="0" maxOccurs="unbounded">
                    <group type="NXfabrication">
                        <field name="vendor" type="NX_CHAR"/>
                        <field name="model" type="NX_CHAR"/>
                    </group>
                </group>
                <group type="NXebeam_column">
                    <group name="electron_source" type="NXsource">
                        <field name="emitter_type" type="NX_CHAR"/>
                        <field name="probe" type="NX_CHAR"/>
                    </group>
                </group>
                <!--voltage like all other dynamic quantities should better be placed in instances of NXevent_data_em-->
                <group type="NXibeam_column" minOccurs="0" maxOccurs="1">
                    <!--there are tri-beam SEMs but they typically use a laser for which we should have an own base class-->
                    <group name="ion_source" type="NXsource">
                        <group name="probe" type="NXion"/>
                    </group>
                </group>
            </group>
            <!--voltage(NX_NUMBER): also this better in instances of NXevent_data_em
does not have to be written out unless that field should be required!
like all other sub-graphs in the NXibeam_column base class and all
the fields they can be used-->
            <group name="event_data_em_set" type="NXevent_data_em_set" minOccurs="0" maxOccurs="1">
                <!--an instance must not have an NXevent_data_em_set but if it has one it must not be more than 1 !-->
                <group type="NXevent_data_em" minOccurs="0" maxOccurs="unbounded">
                    <field name="start_time" type="NX_DATE_TIME" recommended="true"/>
                    <field name="end_time" type="NX_DATE_TIME" recommended="true"/>
                    <group type="NXimage_r_set" minOccurs="0" maxOccurs="unbounded">
                        <group type="NXprocess">
                            <group name="source" type="NXserialized" recommended="true">
                                <field name="type" type="NX_CHAR"/>
                                <field name="path" type="NX_CHAR"/>
                                <field name="checksum" type="NX_CHAR"/>
                                <field name="algorithm" type="NX_CHAR"/>
                            </group>
                            <field name="detector_identifier" type="NX_CHAR"/>
                        </group>
                        <group name="image_oned" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_x" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="image_twod" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_y" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_x" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="image_threed" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_z" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_y" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_x" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_oned" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_image_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_x" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_twod" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_image_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_y" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_x" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_threed" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_image_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_z" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_y" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_x" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                    </group>
                    <group type="NXimage_c_set" minOccurs="0" maxOccurs="unbounded">
                        <group type="NXprocess">
                            <group name="source" type="NXserialized" recommended="true">
                                <field name="type" type="NX_CHAR"/>
                                <field name="path" type="NX_CHAR"/>
                                <field name="checksum" type="NX_CHAR"/>
                                <field name="algorithm" type="NX_CHAR"/>
                            </group>
                            <field name="detector_identifier" type="NX_CHAR"/>
                        </group>
                        <group name="image_oned" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_CHAR"/>
                            <field name="title"/>
                            <field name="real" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="imag" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="image_twod" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_CHAR"/>
                            <field name="title"/>
                            <field name="real" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="imag" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="image_threed" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_CHAR"/>
                            <field name="title"/>
                            <field name="real" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="imag" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_k" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_oned" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_CHAR"/>
                            <field name="title"/>
                            <field name="real" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="imag" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_image_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_twod" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_CHAR"/>
                            <field name="title"/>
                            <field name="real" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="imag" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_image_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_threed" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_CHAR"/>
                            <field name="title"/>
                            <field name="real" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="imag" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_image_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_k" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                    </group>
                    <group type="NXspectrum_set" minOccurs="0" maxOccurs="unbounded">
                        <group type="NXprocess">
                            <group name="source" type="NXserialized" recommended="true">
                                <field name="type" type="NX_CHAR"/>
                                <field name="path" type="NX_CHAR"/>
                                <field name="checksum" type="NX_CHAR"/>
                                <field name="algorithm" type="NX_CHAR"/>
                            </group>
                            <field name="detector_identifier" type="NX_CHAR"/>
                        </group>
                        <group name="spectrum_zerod" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_energy" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="spectrum_oned" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_x" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_energy" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="spectrum_twod" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_y" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_x" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_energy" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="spectrum_threed" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_z" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_y" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_x" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_energy" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                    </group>
                    <!--collection(NXdata):-->
                    <group name="em_lab" type="NXinstrument" recommended="true">
                        <group type="NXebeam_column">
                            <field name="operation_mode" type="NX_CHAR"/>
                            <group name="electron_source" type="NXsource">
                                <field name="voltage" type="NX_NUMBER"/>
                            </group>
                        </group>
                        <group type="NXibeam_column" optional="true">
                            <group name="ion_source" type="NXsource">
                                <group name="probe" type="NXion"/>
                                <field name="voltage" type="NX_NUMBER"/>
                            </group>
                        </group>
                        <group type="NXscanbox_em" optional="true">
                            <field name="scan_schema" type="NX_CHAR"/>
                            <field name="dwell_time" type="NX_NUMBER"/>
                        </group>
                        <group type="NXstage_lab" optional="true"/>
                        <group type="NXdetector" optional="true">
                            <field name="mode" type="NX_CHAR"/>
                        </group>
                        <group name="heater" type="NXobject" optional="true">
                            <field name="current" type="NX_NUMBER" units="NX_CURRENT">
                                <doc>
                                     Nominal current of the heater.
                                </doc>
                            </field>
                            <field name="voltage" type="NX_NUMBER" units="NX_VOLTAGE">
                                <doc>
                                     Nominal voltage of the heater.
                                </doc>
                            </field>
                            <field name="power" type="NX_NUMBER" units="NX_POWER">
                                <doc>
                                     Nominal power of the heater.
                                </doc>
                            </field>
                        </group>
                    </group>
                </group>
            </group>
        </group>
        <!--why at all do we need to add here (NXinstrument) ?
nyaml2nxdl could query the NXem_msr base class definition
and check if an identifier named em_lab exists in this case
it assumes it is em_lab(NXinstrument) and continues.-->
        <group name="simulation" type="NXem_sim" optional="true"/>
        <!--remains to be discussed based on examples
relevant research result post-processed for specific community methods
but normalized in its representation ready to be consumed for a
research data management system-->
        <group type="NXroi" minOccurs="0" maxOccurs="unbounded">
            <doc>
                 A region-of-interest analyzed either during or after the session for which
                 specific processed data are available.
            </doc>
            <!--as soon as one entry is here constrained further
an RDM can be sure to find specific pieces of information in a
specific way but then every user of this application definition
is required to provide such information in this way!-->
            <group name="se" type="NXem_img" optional="true"/>
            <!--remains to be discussed based on examples-->
            <group name="bse" type="NXem_img" optional="true"/>
            <!--remains to be discussed based on examples-->
            <group name="ebsd" type="NXem_ebsd" optional="true"/>
            <!--remains to be discussed based on examples-->
            <group name="eds" type="NXem_eds" optional="true"/>
            <!--remains to be discussed based on examples-->
            <group name="adf" type="NXem_adf" optional="true"/>
            <!--remains to be discussed based on examples-->
            <group name="eels" type="NXem_eels" optional="true"/>
            <!--cl(NXem_cl):
  exists: optional-->
            <group name="correlation" type="NXem_correlation" optional="true"/>
        </group>
    </group>
    <!--remains to be discussed based on examples-->
    <!--finally an example how to map e.g. a simple flat schema to NXem:
https://www.zenodo.org/record/6513745, source path mapped on (->) target path
for all source paths /SEM/ is the src path prefix
for all target paths /entry1/ is the trg path prefix
ID -> experiment_identifier
External/alias ID -> none
User -> map on NXuser instances
Date -> use start_time and end_time respectively
Affiliation -> map on NXuser instances
DOIs -> none, map on NXcite instances
Temperature (of what?) -> be more specific and add as property of group of relevance
Relative humidity (of what? likely lab like temperature) -> NXsample
Environmental gas -> NXsample
Operator -> map on NXuser with specific role
Instrument ID -> map on best matching field from NXfabrication in em_lab
Sample ID -> NXsample/identifier
Parent sample ID -> NXsample/sample_history
Any dataset to be linked with this experiment (too vague for the I in FAIR) -> none
Environmental protection during sample processing -> NXsample
Pre-treatment -> own appdef and connect to NXsample/sample_history
Measurement position (the example is totally unclear) -> NXstage_lab, coordinate system etc.
Detector IDs -> NXdetector/identifier
Accelerating voltage -> electron_source/voltage
Current -> much more possibilities electron_source and NXoptical_system_em
Magnification -> use NXoptical_system_em
Image width -> implicit in roi/NXdata instances
Image size -> see image width
Acquisition mode (too vague) -> map on more expressive fields of NXem
Storage tilt (what is this) for tilt see NXstage_lab
Measurement date (how is it different from Date?
Comments -> any of the description fields, in both cases not fair
the respective TEM group has pixel coordinates, which is all much cleaner
described using NXem_conventions, NXcoordinate_system, etc...-->
</definition>
