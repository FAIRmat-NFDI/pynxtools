<?xml version='1.0' encoding='UTF-8'?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<!--
# NeXus - Neutron and X-ray Common Data Format
#
# Copyright (C) 2014-2024 NeXus International Advisory Committee (NIAC)
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 3 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
# For further information, see http://www.nexusformat.org
-->
<!--
04/2024
Extension of the Draft Version (05/2023) of a NeXus application definition which
serves as a template for various optical spectroscopy experiments

TODO:
- Merge reference_frames with angle_reference_frame
- Rework instrument_calibration_DEVICE - use NXcalibration?
- Beam polarizations: Own Polarization concept with angle or from NXbeam via beam coordinates? (solve reference frame problem first)
- Describe angle_of_detection by NXtransformations
- remove NXmonchromator? as it is already in NXinstrument
- Add NXlens_opt and NXwaveplate to NXinstrument?
- Make sample stage_stage(NXmanipulator)/reference_frame via NXtransformations
- Add properties from NXlens_opt from NXopt to NXlens_opt base class
- Make polfilter_TYPE(NXbeam_device) own base class -\-> rework NXpolarizer_opt. and add them to NXinstrument.
- Make spectralfilter_TYPE(NXbeam_device) own base class -\-> extend NXfilter?  and add them to NXinstrument.-->
<definition xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" category="application" type="group" name="NXopt" extends="NXobject" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
    <symbols>
        <doc>
             Variables used throughout the document, e.g. dimensions or parameters.
        </doc>
        <symbol name="N_spectrum">
            <doc>
                 Length of the spectrum array (e.g. wavelength or energy) of the measured
                 data.
            </doc>
        </symbol>
        <symbol name="N_measurements">
            <doc>
                 Number of measurements (1st dimension of measured_data array). This is
                 equal to the number of parameters scanned. For example, if the experiment
                 was performed at three different temperatures and two different pressures
                 N_measurements = 2*3 = 6.
            </doc>
        </symbol>
        <symbol name="N_detection_angles">
            <doc>
                 Number of detection angles of the beam reflected or scattered off the
                 sample.
            </doc>
        </symbol>
        <symbol name="N_incident_angles">
            <doc>
                 Number of angles of incidence of the incident beam.
            </doc>
        </symbol>
    </symbols>
    <doc>
         A general application definition of optical spectroscopy elements, which may 
         be used as a template to derive specialized optical spectroscopy experiments.
         
         Possible specializations are ellipsometry, Raman spectroscopy, photoluminescence,
         reflectivity/transmission spectroscopy.
         
         A general optical experiment consists of (i) a light/photon source, (ii) a sample,
         (iii) a detector.
    </doc>
    <group type="NXentry">
        <field name="definition">
            <doc>
                 An application definition describing a general optical experiment.
            </doc>
            <attribute name="version">
                <doc>
                     Version number to identify which definition of this application
                     definition was used for this entry/data.
                </doc>
            </attribute>
            <attribute name="url">
                <doc>
                     URL where to find further material (documentation, examples) relevant
                     to the application definition.
                </doc>
            </attribute>
            <enumeration>
                <item value="NXopt"/>
            </enumeration>
        </field>
        <field name="title"/>
        <field name="start_time" type="NX_DATE_TIME">
            <doc>
                 Datetime of the start of the measurement.
                 Should be a ISO8601 date/time stamp. It is recommended to add an explicit time zone,
                 otherwise, the local time zone is assumed per ISO8601.
            </doc>
        </field>
        <field name="end_time" type="NX_DATE_TIME" recommended="true">
            <doc>
                 Datetime of the end of the measurement.
                 Should be a ISO8601 date/time stamp. It is recommended to add an explicit time zone,
                 otherwise the local time zone is assumed per ISO8601.
            </doc>
        </field>
        <group name="experiment_identifier" type="NXidentifier" recommended="true">
            <doc>
                 A (globally persistent) unique identifier of the experiment.
                 (i) The identifier is usually defined by the facility, laboratory or
                 principal investigator.
                 (ii) The identifier enables to link experiments to e.g. proposals.
            </doc>
            <field name="service" type="NX_CHAR" optional="true"/>
            <field name="identifier" type="NX_CHAR" recommended="true"/>
            <field name="is_persistent" type="NX_BOOLEAN" optional="true"/>
        </group>
        <field name="experiment_description" optional="true">
            <doc>
                 An optional free-text description of the experiment.
                 
                 Users are strongly advised to parameterize the description of their experiment
                 by using respective groups and fields and base classes instead of writing prose
                 into this field.
                 
                 The reason is that such a free-text field is difficult to machine-interpret.
                 The motivation behind keeping this field for now is to learn how far the
                 current base classes need extension based on user feedback.
            </doc>
        </field>
        <field name="experiment_type">
            <doc>
                 Specify the type of the optical experiment.
                 
                 Chose other if none of these methods are suitable. You may specify
                 fundamental characteristics or properties in the experimental sub-type.
            </doc>
            <enumeration>
                <item value="ellipsometry"/>
                <item value="Raman spectroscopy"/>
                <item value="photoluminescence"/>
                <item value="transmission spectroscopy"/>
                <item value="reflection spectroscopy"/>
                <item value="other"/>
            </enumeration>
        </field>
        <field name="experiment_sub_type" optional="true">
            <doc>
                 Specify a special property or characteristic of the experiment, which specifies
                 the generic experiment type.
            </doc>
            <enumeration>
                <item value="time resolved"/>
                <item value="imaging"/>
                <item value="pump-probe"/>
                <item value="other"/>
            </enumeration>
        </field>
        <!--Replace maybe sub_type with exp_technique?
experimental technique -\-> pump-probe, parameters seperated (i.e. time, space)?
The above listed things are related to beam properties? This is different
compared to temperature or pressure. Is this a useful distinction?-->
        <field name="experiment_type_other" optional="true">
            <doc>
                 If "other" was selected in "experiment_type" and/or in "experiment_sub_type",
                 specify the experiment here with a free text name, which is knwon in the
                 respective community of interest.
            </doc>
        </field>
        <!--
This should be extended later and hopefully replace angle_reference_frame
and sample_normal_direction.
Required reference frames:
Sample normal, beam_z_axis, sample_stage
-->
        <group name="reference_frames" type="NXcoordinate_system_set" optional="true">
            <doc>
                 Description of one or more coordinate systems that are specific to the
                 experiment.
            </doc>
        </group>
        <group type="NXuser" minOccurs="0" maxOccurs="unbounded">
            <doc>
                 Contact information and eventually details of at persons who
                 performed the measurements. This can be for example the principal
                 investigator or student. Examples are: name, affiliation, address, telephone
                 number, email, role as well as identifiers such as orcid or similar. 
                 It is recommended to add multiple users if relevant.
                 
                 Due to data privacy concerns, there is no minimum requirement.
            </doc>
        </group>
        <group type="NXinstrument">
            <doc>
                 Devices or elements of the optical spectroscopy setup described with its
                 properties and general information.
                 
                 This includes for example:
                 - The beam device's or instrument's model, company, serial number, construction year, etc.
                 - Used software or code
                 - Experiment descriptive parameters as reference frames, resolution, calibration
                 - Photon beams with their respective properties such as angles and polarization
                 - Various optical beam path devices, which interact, manipulate or measure optical beams
                 - Characteristics of the medium surrounding the sample
                 - "Beam devices" for a beam path description
                 - Stages(NXmanipulator)
                 - Sensors and actuators to control or measure sample or beam properties
            </doc>
            <group name="device_information" type="NXfabrication" recommended="true">
                <doc>
                     General device information of the optical spectroscopy setup, if
                     suitable (e.g. for a tabletop spectrometer or other non-custom build setups).
                     For custom build setups, this may be limited to the construction year.
                </doc>
                <field name="vendor" recommended="true"/>
                <field name="model" recommended="true"/>
                <field name="identifier" recommended="true"/>
                <field name="construction_year" type="NX_DATE_TIME" optional="true"/>
            </group>
            <group name="software_TYPE" type="NXprogram" recommended="true">
                <field name="program">
                    <doc>
                         Commercial or otherwise defined given name of the program that was
                         used to control any parts of the optical spectroscopy setup.
                         The uppercase TYPE should be replaced by a specification name, i.e.
                         "software_detector" or "software_stage" to specify the respective
                         program or software components.
                    </doc>
                    <attribute name="version" recommended="true">
                        <doc>
                             Either version with build number, commit hash, or description of a
                             (online) repository where the source code of the program and build
                             instructions can be found so that the program can be configured in
                             such a way that result files can be created ideally in a
                             deterministic manner.
                        </doc>
                    </attribute>
                    <attribute name="url" optional="true">
                        <doc>
                             Description of the software by persistent resource, where the program,
                             code, script etc. can be found.
                        </doc>
                    </attribute>
                </field>
            </group>
            <!--The angle_reference_frame will be connected later to general reference frames
For this this solution enables the description of the beam relations for
different optical spectroscopy methods in the reference frame they are used to-->
            <field name="angle_reference_frame">
                <doc>
                     Defines the reference frame which is used to describe the sample orientation
                     with respect to the beam directions.
                     
                     A beam centered description is the default and uses 4 angles(similar to XRD):
                       - Omega (angle between sample surface and incident beam)
                       - 2Theta (angle between the transmitted beam and the detection beam)
                       - Chi (sample tilt angle, angle between plane#1 and the surface normal,
                             plane#1 = spanned by incidence beam and detection
                             and detection. If Chi=0°, then plane#1 is the plane of
                             incidence in reflection setups)
                       - Phi (inplane rotation of sample, rotation axis is the samples 
                             surface normal)
                     
                     
                     A sample normal centered description is as well possible(similar to XX):
                       - angle of incidence (angle between incident beam and sample surface)
                       - angle of detection (angle between detection beam and sample surface)
                       - angle of incident and detection beam (angle between the incident and scattering beam)
                       - angle of in-plane sample rotation (direction along the sample's surface normal)
                </doc>
                <!--For the sample centered approach, it has to be avoided, that the detection beam,
incident beam or surface normal beam are parallel to each other
(Is this a problem for Raman backscattering?)
For beam centered approach (as done for beamlines), the grativation and beam direction are used to define
the coordinate system. As beamlines are usually built flat - there is no case
in which these two vectors can be parallel to each other
This is different with the surface normal. Aside of the surface normal,
at least one further additional natural direction is required.
This could be the magnetic/geographic north pole
magnetic north pole: easy to determine, but time depenent (long term)
geographic north pole: harder to determine? (What about GPS?), but constant with time-->
                <enumeration>
                    <item value="beam centered"/>
                    <item value="sample normal centered"/>
                </enumeration>
            </field>
            <group name="wavelength_resolution" type="NXresolution" optional="true">
                <doc>
                     The overall resolution of the optical instrument.
                </doc>
                <field name="physical_quantity">
                    <enumeration>
                        <item value="wavelength"/>
                    </enumeration>
                </field>
                <field name="type" recommended="true"/>
                <field name="resolution" type="NX_FLOAT" units="NX_WAVELENGTH">
                    <doc>
                         Minimum distinguishable wavelength separation of peaks in spectra.
                    </doc>
                </field>
            </group>
            <group name="instrument_calibration_DEVICE" type="NXsubentry" recommended="true">
                <doc>
                     Pre-calibration of an arbitrary device of the instrumental setup, which
                     has the name DEVICE. You can specify here how, at which time by which method
                     the calibration was done. As well the accuracy and a link to the calibration
                     dataset.
                </doc>
                <field name="device_path" recommended="true">
                    <doc>
                         Path to the device, which was calibrated.
                         Example: entry/instrument/DEVICE
                    </doc>
                </field>
                <field name="calibration_method" optional="true">
                    <doc>
                         Describe here the approach or method, used to perform the calibration, by a free
                         text.
                    </doc>
                </field>
                <group name="calibration_accuracy" type="NXdata" optional="true">
                    <doc>
                         Provide data about the determined accuracy of the device, this may
                         may be a single value or a dataset like wavelength error vs. wavelength etc.
                    </doc>
                </group>
                <field name="calibration_status" type="NX_CHAR" recommended="true">
                    <doc>
                         Was a calibration performed? If yes, when was it done? If the
                         calibration time is provided, it should be specified in
                         ENTRY/INSTRUMENT/calibration/calibration_time.
                    </doc>
                    <enumeration>
                        <item value="calibration time provided"/>
                        <item value="no calibration"/>
                        <item value="within 1 hour"/>
                        <item value="within 1 day"/>
                        <item value="within 1 week"/>
                    </enumeration>
                </field>
                <field name="calibration_time" type="NX_DATE_TIME" optional="true">
                    <doc>
                         If calibtration status is 'calibration time provided', specify the
                         ISO8601 date when calibration was last performed before this
                         measurement. UTC offset should be specified.
                    </doc>
                </field>
                <group name="calibration_data_link" type="NXidentifier" recommended="true">
                    <doc>
                         Link to the NeXus file containing the calibration data and metadata.
                    </doc>
                </group>
            </group>
            <!--Discussion
##########
The basic idea was: You have always an incident source and a detector.
Therefore, you always have an incident beam and a "detection beam".
These beams can be assigned clear incident and detection angles.

This information is always of relevance for ellipsometry,
but for Raman experiments, the state of polarization is as well of relevance
Additonally, this is limited for incident, detection and sample normal
to be in one plane. This does not have to be the case for Raman scattering
experiments. Therefore, this is not general enough and may be moved to
NXellipsometry.
This information may be as well stored in an incident and detection beam-->
            <!--beam properties-->
            <group name="beam_TYPE" type="NXbeam" minOccurs="0" maxOccurs="unbounded">
                <doc>
                     Beam characteristics between two beam_devices.
                     
                     It is recommended to at least define one incident and one detection beam.
                     If this beam is directly connected to a source, chose here the same
                     name appendix as for the NXsource (e.g. TYPE=532nm)
                </doc>
                <field name="incident_wavelength" type="NX_NUMBER" recommended="true"/>
                <field name="incident_wavelength_spread" type="NX_NUMBER" recommended="true"/>
                <field name="incident_polarization" type="NX_NUMBER" recommended="true"/>
                <field name="extent" type="NX_FLOAT" recommended="true"/>
                <field name="associated_source" type="NX_CHAR" optional="true">
                    <doc>
                         The path to the source which emitted this beam.
                         
                         Is recommended, if the previous optical element is a photon source.
                         In this way, the properties of the laser or light souce can be described
                         and associated.
                         The beam should be named with the same appendix as the source, e.g.,
                         for TYPE=532nmlaser, there should be both a NXsource named
                         "source_532nmlaser" and a NXbeam named "beam_532nmlaser".
                         
                         Example: /entry/instrument/source_532nmlaser
                    </doc>
                </field>
                <!--The two polarization descriptions may be completely replaced by polarization-->
                <field name="beam_polarization_type" optional="true">
                    <enumeration>
                        <item value="linear"/>
                        <item value="circular"/>
                        <item value="ellipically"/>
                        <item value="unpolarized"/>
                    </enumeration>
                </field>
                <field name="linear_beam_sample_polarization" type="NX_NUMBER" optional="true" units="NX_ANGLE">
                    <doc>
                         Description of the light polarization of the respective beam and the beam-sample-normal.
                         This is only well defined, if the beam direclty hits the sample (either indicent
                         beam or detection beam) and if the samples needs to have a clearly
                         defined sample surface. The beam-sample-normal plane is spanned by
                         the beam and the samples surface normal.
                         
                         If the electric field in in this plane, this value is 0° (P-pol)
                         If the electric field is perpendicular to this plane, this value is 90° (S-pol)
                         If the surface normal is parallel to the beam direction, then only the
                         relation between different polarizations has to be consistent 
                         (i.e. parallel polarized 0° and cross polarized 90°)
                    </doc>
                </field>
            </group>
            <!--The given angles may be extended similar to NXmpes, to allow a simple
as well as an arbitrary description via NXtransformations

fundamental orientation of incident and detection beam-->
            <!--
relation beam directions (incident and detection) with sample orientation
these angles are quite simple. They might be extended similar to
NXmpes_liquid with leaf_normal to allow arbitrary description.
this might require a different reference frame.
-->
            <field name="angle_of_incidence" type="NX_NUMBER" optional="true" units="NX_ANGLE">
                <doc>
                     Angle(s) of the incident beam vs. the normal of the bottom reflective
                     (substrate) surface in the sample. These two directions span the plane
                     of incidence.
                </doc>
                <dimensions rank="1">
                    <dim index="1" value="N_incident_angles"/>
                </dimensions>
                <attribute name="units"/>
            </field>
            <field name="angle_of_detection" type="NX_NUMBER" optional="true" units="NX_ANGLE">
                <doc>
                     Detection angle(s) of the beam reflected or scattered off the sample
                     vs. the normal of the bottom reflective (substrate) surface in the
                     sample if not equal to the angle(s) of incidence.
                     These two directions span the plane of detection.
                </doc>
                <dimensions rank="1">
                    <dim index="1" value="N_detection_angles"/>
                </dimensions>
            </field>
            <field name="angle_of_incident_and_detection_beam" type="NX_NUMBER" optional="true" units="NX_ANGLE">
                <doc>
                     Angle between the incident and detection beam.
                     If angle_of_detection + angle_of_incidence = angle_of_incident_and_detection_beam,
                     then the setup is a reflection setup.
                     If angle_of_detection + angle_of_incidence != angle_of_incident_and_detection_beam
                     then the setup may be a light scattering setup.
                     (i.e. 90° + 90° != 90°, i.e. incident and detection beam in the sample surface, but
                     the angle source-sample-detector is 90°)
                </doc>
                <dimensions rank="1">
                    <dim index="1" value="XX"/>
                </dimensions>
                <attribute name="units"/>
            </field>
            <field name="angle_of_in_plane_sample_rotation" type="NX_NUMBER" optional="true" units="NX_ANGLE">
                <doc>
                     Angle of the inplane orientation of the sample. This might be an arbitrary,
                     angle without specific relation to the sample symmetry,
                     of the angle to a specific sample property (i.e. crystallographic axis or sample
                     shape such as wafer flat)
                </doc>
                <dimensions rank="1">
                    <dim index="1" value="XX"/>
                </dimensions>
            </field>
            <field name="lateral_focal_point_offset" type="NX_NUMBER" optional="true" units="NX_LENGTH">
                <doc>
                     Specify if there is a lateral offset on the sample surface, between the focal 
                     points of the incident beam and the detection beam.
                </doc>
            </field>
            <!--beam path elements-->
            <group name="source_TYPE" type="NXsource" minOccurs="1" maxOccurs="unbounded">
                <field name="type" recommended="true">
                    <enumeration>
                        <item value="laser"/>
                        <item value="dye-laser"/>
                        <item value="broadband tunable light source"/>
                        <item value="X-ray Source"/>
                        <item value="arc lamp"/>
                        <item value="halogen lamp"/>
                        <item value="LED"/>
                        <item value="other"/>
                    </enumeration>
                </field>
                <field name="type_other" optional="true">
                    <doc>
                         Specification of type, may also go to name.
                    </doc>
                </field>
                <field name="name" recommended="true"/>
                <group name="device_information" type="NXfabrication">
                    <doc>
                         Details about the device information.
                    </doc>
                </group>
                <field name="associated_beam" type="NX_CHAR">
                    <doc>
                         The path to a beam emitted by this source.
                         Should be named with the same appendix, e.g.,
                         for TYPE=532nmlaser, there should as well be
                         a NXbeam named "beam_532nmlaser" together with this source
                         instance named "source_532nmlaser"
                         
                         Example: /entry/instrument/beam_532nmlaser
                    </doc>
                </field>
                <group name="device_characteristics" type="NXdata" optional="true">
                    <doc>
                         You may add here data which characterises the source in more detail,
                         such as spectral power density, power dependency on line width, line-shape
                         of the laser line, etc.
                    </doc>
                </group>
            </group>
            <group name="detector_TYPE" type="NXdetector" minOccurs="1" maxOccurs="unbounded">
                <field name="detector_channel_type" recommended="true">
                    <enumeration>
                        <item value="single-channel"/>
                        <item value="multichannel"/>
                    </enumeration>
                </field>
                <field name="detector_type" recommended="true">
                    <doc>
                         Description of the detector type.
                    </doc>
                    <enumeration>
                        <item value="CCD"/>
                        <item value="Photomultiplier"/>
                        <item value="Photodiode"/>
                        <item value="Avalanche-Photodiode"/>
                        <item value="Bolometer"/>
                        <item value="Golay Detectors"/>
                        <item value="Pyroelectric Detector"/>
                        <item value="other"/>
                    </enumeration>
                </field>
                <field name="detector_type_other" optional="true">
                    <doc>
                         Type of detector, if "other" was selected in "detector_type".
                    </doc>
                </field>
                <group name="device_characteristics" type="NXdata" optional="true">
                    <doc>
                         You may add here data which characterizes the detector, such as quantum
                         efficiency as function of wavelength or angular dependency of intenty.
                    </doc>
                </group>
                <group name="device_information" type="NXfabrication" recommended="true">
                    <field name="vendor" recommended="true"/>
                    <field name="model" recommended="true"/>
                    <field name="identifier" recommended="true"/>
                </group>
                <group name="raw_data" type="NXdata" recommended="true">
                    <doc>
                         Contains the raw data collected by the detector before calibration.
                         The data which is considered raw might change from experiment to experiment
                         due to hardware pre-processing of the data.
                         This field ideally collects the data with the lowest level of processing
                         possible.
                    </doc>
                    <!--Define a similar convention for NXopt? Or only for NXraman, NXellipsometry and NXphotoluminescence?
 Fields should be named according to new following convention:

 - **pixel_x**: Detector pixel in x direction.
 - **pixel_y**: Detector pixel in y direction.
 - **energy**: (Un)calibrated energy (kinetic or binding energy). Unit category: NX_ENERGY (e.g., eV).
 - **kx**: (Un)calibrated x axis in k-space. Unit category: NX_ANY (e.g., 1/Angström).
 - **ky**: (Un)calibrated y axis in k-space. Unit category: NX_ANY (1/Angström).
 - **kz**: (Un)calibrated z axis in k-space. Unit category: NX_ANY (1/Angström).
 - **angular0**: Fast-axis angular coordinate (or second slow axis if angularly integrated).
   Unit category: NX_ANGLE
 - **angular1**: Slow-axis angular coordinate (or second fast axis if simultaneously dispersed in 2 dimensions)
   Unit category: NX_ANGLE
 - **spatial0**: Fast-axis spatial coordinate (or second slow axis if spatially integrated)
   Unit category: NX_LENGTH
 - **spatial1**: Slow-axis spatial coordinate (or second fast axis if simultaneously dispersed in 2 dimensions)
   Unit category: NX_LENGTH
 - **delay**: Calibrated delay time. Unit category: NX_TIME (s).
 - **polarization_angle**: Linear polarization angle of the incoming or
   outgoing beam.
   Unit category: NX_ANGLE (° or rad)
 - **ellipticity**: Ellipticity of the incoming or outgoing beam.
   Unit category: NX_ANGLE (° or rad)
 - **time_of_flight**: Total time of flight. Unit category: NX_TIME_OF_FLIGHT
 - **time_of_flight_adc**: Time-of-flight values, analog-to-digital converted.
 - **external_AXIS**: Describes an axis which is coming from outside the detectors scope.-->
                    <attribute name="signal">
                        <enumeration>
                            <item value="raw"/>
                        </enumeration>
                    </attribute>
                    <field name="raw" type="NX_NUMBER">
                        <doc>
                             Raw data before calibration.
                        </doc>
                    </field>
                </group>
            </group>
            <group type="NXmonochromator" optional="true">
                <group name="device_characteristics" type="NXdata" optional="true">
                    <doc>
                         Characteristics of the monochromator as diffraction efficiency as 
                         wavelength and polarization dependence
                    </doc>
                </group>
                <group name="device_information" type="NXfabrication" recommended="true">
                    <field name="vendor" recommended="true"/>
                    <field name="model" recommended="true"/>
                    <field name="identifier" recommended="true"/>
                </group>
            </group>
            <group type="NXlens_opt" optional="true">
                <doc>
                     This is the optical element used to focus or collect light. This may
                     be a genereic lens or microcope objectives which are used for the
                     Raman scattering process.
                </doc>
                <field name="type">
                    <enumeration>
                        <item value="objective"/>
                        <item value="lens"/>
                        <item value="glass fiber"/>
                        <item value="none"/>
                        <item value="other"/>
                    </enumeration>
                </field>
                <field name="numerical_aperture" type="NX_NUMBER">
                    <doc>
                         The numerical aperture of the used incident light optics.
                    </doc>
                </field>
                <field name="magnification" type="NX_FLOAT">
                    <doc>
                         Magnification of the lens.
                    </doc>
                </field>
                <group name="device_information" type="NXfabrication" recommended="true">
                    <doc>
                         Details about the optical component, if available.
                    </doc>
                </group>
                <group name="device_characteristics" type="NXdata"/>
            </group>
            <group type="NXwaveplate" optional="true">
                <group name="device_characteristics" type="NXdata"/>
            </group>
            <group type="NXopt_window"/>
            <field name="sample_medium_refractive_indices" type="NX_FLOAT" optional="true" units="NX_UNITLESS">
                <doc>
                     Array of pairs of complex refractive indices n + ik of the medium
                     for every measured spectral point/wavelength/energy.
                     Only necessary if the measurement was performed not in air, or
                     something very well known, e.g. high purity water.
                </doc>
                <dimensions rank="2">
                    <dim index="1" value="2"/>
                    <dim index="2" value="N_spectrum"/>
                </dimensions>
            </field>
            <group name="polfilter_TYPE" type="NXbeam_device" optional="true">
                <doc>
                     polarization filter to prepare light to be measured or to be incident 
                     on the sample.
                     Genereric polarization filter porperties may be implemented via NXfilter_pol
                     at a later stage.
                </doc>
                <field name="filter_mechanism" type="NX_CHAR" optional="true">
                    <doc>
                         Physical principle of the polarization filter used to create a
                         defined incident or scattered light state.
                    </doc>
                    <enumeration>
                        <item value="Polarization by Fresnel reflection"/>
                        <item value="Birefringent polarizers"/>
                        <item value="Thin film polarizers"/>
                        <item value="Wire-grid polarizers"/>
                        <item value="other"/>
                    </enumeration>
                </field>
                <field name="specific_polarization_filter_type" type="NX_CHAR" optional="true">
                    <doc>
                         Specific name or type of the polarizer used.
                         
                         Free text, for example: Glan-Thompson, Glan-Taylor, Rochon Prism, Wollaston
                         Polarizer...
                    </doc>
                </field>
                <group name="device_information" type="NXfabrication"/>
            </group>
            <group name="spectralfilter_TYPE" type="NXbeam_device" optional="true">
                <doc>
                     Spectral filter used to modify properties of the scattered or incident light.
                     Genereric spectral filter porperties may be implemented via NXfilter_spec
                     at a later stage.
                </doc>
                <field name="filter_type" optional="true">
                    <doc>
                         Type of laserline filter used to supress the laser, if measurements
                         close to the laserline are performed.
                    </doc>
                    <enumeration>
                        <item value="long-pass filter"/>
                        <item value="short-pass filter"/>
                        <item value="Notch filter"/>
                        <item value="reflection filter"/>
                        <item value="neutral density filter"/>
                        <item value="other"/>
                    </enumeration>
                </field>
                <field name="intended_use" optional="true">
                    <doc>
                         Type of laserline filter used to supress the laser, if measurements
                         close to the laserline are performed.
                    </doc>
                    <enumeration>
                        <item value="laser line cleanup"/>
                        <item value="raylight line removal"/>
                        <item value="spectral filtering"/>
                        <item value="intensity manipulation"/>
                        <item value="other"/>
                    </enumeration>
                </field>
                <group name="filter_characteristics" type="NXdata" optional="true">
                    <doc>
                         Properties of the spectral filter such as wavelength dependent Transmission
                         or reflectivity.
                    </doc>
                    <attribute name="characteristics_type" optional="true">
                        <doc>
                             Which property is used to form the spectral properties of light,
                             i.e. transmission or reflection properties.
                        </doc>
                        <enumeration>
                            <item value="transmission"/>
                            <item value="reflection"/>
                        </enumeration>
                    </attribute>
                </group>
                <group name="device_information" type="NXfabrication"/>
            </group>
            <!--In the following - Auxillary NXbeam_devices are defined, to enable a
beam path description of the setup, while using the up now available
Nexus definitions for source, detector, monochromator, ...-->
            <!--beam devices for beam path description-->
            <group type="NXbeam_device" minOccurs="0" maxOccurs="unbounded">
                <doc>
                     Describes the order of respective beam devices in the optical beam
                     path.
                     
                     Everything object which interacts or modifies optical beam properties,
                     may be an beam device, e.g. Filter, Window, Beamsplitter, Photon Source,
                     Detector, etc,
                     
                     It is intended, to include this functionality later to "older" beam
                     components, such as NXsource, NXdetector, NXlens, etc.
                     Until this is possbible, auxillary beam devices have to be created,
                     for each "older" beam component instead, to allow a beam path description.
                     To link the auxillary beam device to the real device properties, the
                     attribute \@device should be used.
                </doc>
                <attribute name="device" recommended="true">
                    <doc>
                         Reference to beam device, which is described by a NeXus concept
                         (e.g. for NXsource, entry/instrument/source_TYPE).
                    </doc>
                </attribute>
                <field name="previous_device" recommended="true">
                    <doc>
                         Reference to the previous beam device, from which the photon beam came
                         to reach this beam device. A photon source is related as origin by ".".
                         This enables a logical order description of the optical setup.
                    </doc>
                </field>
            </group>
            <!--non-beam path elements-->
            <group name="sample_stage" type="NXmanipulator" optional="true">
                <doc>
                     Sample stage (or manipulator) for positioning of the sample. This should
                     only contain the spatial orientation of movement.
                </doc>
                <field name="stage_type" optional="true">
                    <doc>
                         Specify the type of the sample stage.
                    </doc>
                    <enumeration>
                        <item value="manual stage"/>
                        <item value="scanning stage"/>
                        <item value="liquid stage"/>
                        <item value="gas cell"/>
                        <item value="cryostat"/>
                        <item value="heater"/>
                        <item value="other"/>
                    </enumeration>
                </field>
                <field name="stage_type_other" optional="true">
                    <doc>
                         If "other" was chosen in stage_type, enter here a free text description
                         of the stage type.
                    </doc>
                </field>
                <!--This is for now a placeholder and should be specified with NXtransformation-->
                <field name="reference_frame" optional="true">
                    <doc>
                         This is a placeholder, to describe the relation between the samples
                         coordinate system, laboratory coordinate system and the stage coordinate
                         system. Up to now, use the "beam_sample_relation" to give supporting
                         information.
                    </doc>
                </field>
                <field name="beam_sample_relation" optional="true">
                    <doc>
                         Description of relation of the beam with the sample. How dit the
                         sample hit the beam, e.g. 'center of sample, long edge parallel
                         to the plane of incidence'.
                    </doc>
                </field>
                <group name="device_information" type="NXfabrication"/>
            </group>
            <group name="temperature_sensor" type="NXsensor" recommended="true">
                <field name="name" recommended="true"/>
                <field name="measurement">
                    <enumeration>
                        <item value="temperature"/>
                    </enumeration>
                </field>
                <field name="type" optional="true"/>
                <field name="value" type="NX_FLOAT"/>
                <group name="device_information" type="NXfabrication"/>
            </group>
            <group name="temp_control_TYPE" type="NXactuator" optional="true">
                <doc>
                     Type of control for the sample temperature. Replace TYPE by "cryostat" or
                     "heater" to specify it.
                </doc>
                <field name="name" recommended="true"/>
                <field name="physical_quantity">
                    <enumeration>
                        <item value="temperature"/>
                    </enumeration>
                </field>
                <field name="cooler_or_heater" recommended="true">
                    <enumeration>
                        <item value="cooler"/>
                        <item value="heater"/>
                    </enumeration>
                </field>
                <field name="type" optional="true">
                    <doc>
                         Hardware used for actuation, i.e. laser, gas lamp, filament, resistive
                    </doc>
                </field>
                <group type="NXpid">
                    <field name="setpoint" type="NX_FLOAT" recommended="true"/>
                </group>
                <group name="device_information" type="NXfabrication"/>
            </group>
        </group>
        <group type="NXsample">
            <doc>
                 Properties of the sample, such as sample type, layer structure,
                 chemical formula, atom types, its history etc.
                 Information about the sample stage and sample environment should be
                 described in ENTRY/INSTRUMENT/sample_stage.
            </doc>
            <field name="sample_name">
                <doc>
                     Name of the sample, which is uaually pleases human readability.
                     This may be, but does not have to be identical to the sample_id.
                </doc>
            </field>
            <field name="sample_id" recommended="true">
                <doc>
                     Uniquely identifying ID of the sample.
                </doc>
            </field>
            <field name="physical_form" recommended="true">
                <doc>
                     State the form of the sample, examples are:
                     thin film, single crystal, poly crystal, amorphous, single layer,
                     multi layer, liquid, gas, pellet, powder.
                </doc>
            </field>
            <field name="description" optional="true">
                <doc>
                     Free text description of the sample.
                </doc>
            </field>
            <field name="chemical_formula" recommended="true">
                <doc>
                     Chemical formula of the sample. Use the Hill system (explained here:
                     https://en.wikipedia.org/wiki/Chemical_formula#Hill_system) to write
                     the chemical formula. In case the sample consists of several layers,
                     this should be a list of the chemical formulas of the individual
                     layers, where the first entry is the chemical formula of the top
                     layer (the one on the front surface, on which the light incident).
                     The order must be consistent with layer_structure
                </doc>
            </field>
            <field name="atom_types" optional="true">
                <doc>
                     List of comma-separated elements from the periodic table that are
                     contained in the sample. If the sample substance has multiple
                     components, all elements from each component must be included in
                     'atom_types'.
                </doc>
            </field>
            <field name="preparation_date" type="NX_DATE_TIME" recommended="true">
                <doc>
                     ISO 8601 time code with local time zone offset to UTC information
                     when the specimen was prepared.
                     
                     Ideally, report the end of the preparation, i.e. the last known timestamp when
                     the measured specimen surface was actively prepared.
                </doc>
            </field>
            <group name="history" type="NXhistory" recommended="true">
                <doc>
                     A set of activities that occurred to the sample prior to/during the experiment.
                </doc>
            </group>
            <group name="temperature" type="NXenvironment" recommended="true">
                <doc>
                     Sample temperature (either controlled or just measured).
                </doc>
                <group name="temperature_sensor" type="NXsensor">
                    <doc>
                         Temperature sensor measuring the sample temperature.
                         This should be a link to /entry/instrument/manipulator/temperature_sensor.
                    </doc>
                </group>
                <group name="sample_heater" type="NXactuator" optional="true">
                    <doc>
                         Device to heat the sample.
                         This should be a link to /entry/instrument/manipulator/sample_heater.
                    </doc>
                </group>
                <group name="sample_cooler" type="NXactuator" optional="true">
                    <doc>
                         Device for cooling the sample (Cryostat, Airflow cooler, etc.).
                         This should be a link to /entry/instrument/manipulator/cryostat.
                    </doc>
                </group>
            </group>
            <group type="NXenvironment" optional="true">
                <doc>
                     Arbirary sample property which may be varied during the experiment
                     and controlled by a device. Examples are pressure, voltage, magnetic field etc.
                     Similar to the temperautre description of the sample.
                </doc>
                <field name="sample_medium" recommended="true">
                    <enumeration>
                        <item value="air"/>
                        <item value="vacuum"/>
                        <item value="inert atmosphere"/>
                        <item value="oxidising atmosphere"/>
                        <item value="reducing atmosphere"/>
                        <item value="sealed can"/>
                        <item value="water"/>
                        <item value="other"/>
                    </enumeration>
                </field>
            </group>
            <!--
Make something like NXlayer_structure_sample?
-->
            <field name="thickness" type="NX_NUMBER" optional="true" units="NX_LENGTH">
                <doc>
                     (Measured) sample thickness.
                     
                     The information is recorded to qualify if the light used was likely
                     able to shine through the sample. 
                     
                     In this case the value should be set to the actual thickness of
                     the specimen viewed for an illumination situation where the nominal
                     surface normal of the specimen is parallel to the optical axis.
                </doc>
            </field>
            <field name="thickness_determination" optional="true">
                <doc>
                     If a thickness if given, please specify how this thickness was estimated or
                     determined.
                </doc>
            </field>
            <!--
Maybe consider here to include NXsample_component_set.
-->
            <field name="layer_structure" optional="true">
                <doc>
                     Qualitative description of the layer structure for the sample,
                     starting with the top layer (i.e. the one on the front surface, on
                     which the light incident), e.g. native oxide/bulk substrate, or
                     Si/native oxide/thermal oxide/polymer/peptide.
                </doc>
            </field>
            <field name="sample_orientation" optional="true">
                <doc>
                     Specify the sample orientation, how is its sample normal oriented
                     relative in the laboratory reference frame, incident beam reference
                     frame.
                </doc>
            </field>
            <field name="substrate" recommended="true">
                <doc>
                     If the sample is grown or fixed on a substrate, specify this here by
                     a free text description.
                </doc>
            </field>
        </group>
        <group type="NXdata">
            <doc>
                 Here generic types of data may be saved.. This may refer to data derived
                 from single or multiple raw measurements (i.e. several intensities are
                 evaluated for different parameters: ellipsometry -&gt; psi and delta) -
                 i.e. non-raw data. 
                 As well plotable data may be stored/linked here, which provides the most suitable
                 representation of the data (for the respective community).
                 
                 You may provide multiple instances of NXdata
            </doc>
            <attribute name="axes">
                <doc>
                     Spectrum, i.e. x-axis of the data (e.g. wavelength, energy etc.)
                </doc>
            </attribute>
            <attribute name="signal">
                <doc>
                     Spectrum, i.e. y-axis of the data (e.g. counts, intensity)
                </doc>
            </attribute>
        </group>
        <group name="measurement_data_calibration" type="NXprocess">
            <group name="wavelength_calibration" type="NXcalibration" optional="true">
                <field name="calibrated_axis" type="NX_FLOAT" recommended="true">
                    <doc>
                         Location to save the calibrated wavelength data.
                    </doc>
                </field>
            </group>
        </group>
        <!--The old "data_collection(NXprocess)" is now replaced by more flexbile
NXdata. The detailed inclusion of a data collection description (i.e.
raw data from ellipsometry as polarization values to the usually used
psi and delta values), will be done later after the NXopt workshop.-->
        <group name="derived_parameters" type="NXprocess" optional="true">
            <doc>
                 &gt;&gt;&gt;This section is transfered from the first NXopt version and might
                 require a reqwork.&lt;&lt;&lt;
                 Parameters that are derived from the measured data.
            </doc>
            <field name="depolarization" type="NX_NUMBER" optional="true" units="NX_UNITLESS">
                <doc>
                     Light loss due to depolarization as a value in [0-1].
                </doc>
                <dimensions rank="3">
                    <dim index="1" value="N_measurements"/>
                    <dim index="2" value="1"/>
                    <dim index="3" value="N_spectrum"/>
                </dimensions>
            </field>
            <field name="jones_quality_factor" type="NX_NUMBER" optional="true" units="NX_UNITLESS">
                <doc>
                     Jones quality factor.
                </doc>
                <dimensions rank="3">
                    <dim index="1" value="N_measurements"/>
                    <dim index="2" value="1"/>
                    <dim index="3" value="N_spectrum"/>
                </dimensions>
            </field>
            <field name="reflectivity" type="NX_NUMBER" optional="true" units="NX_UNITLESS">
                <doc>
                     Reflectivity.
                </doc>
                <dimensions rank="3">
                    <dim index="1" value="N_measurements"/>
                    <dim index="2" value="1"/>
                    <dim index="3" value="N_spectrum"/>
                </dimensions>
            </field>
            <field name="transmittance" type="NX_NUMBER" optional="true" units="NX_UNITLESS">
                <doc>
                     Transmittance.
                </doc>
                <dimensions rank="3">
                    <dim index="1" value="N_measurements"/>
                    <dim index="2" value="1"/>
                    <dim index="3" value="N_spectrum"/>
                </dimensions>
            </field>
            <group name="ANALYSIS_program" type="NXprocess" optional="true">
                <field name="program">
                    <doc>
                         Commercial or otherwise defined given name of the program that was
                         used to generate or calculate the derived parameters.
                         If home written, one can provide the actual steps in the NOTE
                         subfield here.
                    </doc>
                </field>
                <field name="version">
                    <doc>
                         Either version with build number, commit hash, or description of a
                         (online) repository where the source code of the program and build
                         instructions can be found so that the program can be configured in
                         such a way that result files can be created ideally in a
                         deterministic manner.
                    </doc>
                </field>
            </group>
        </group>
    </group>
</definition>
